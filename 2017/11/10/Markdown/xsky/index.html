<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Glody&#39;s Notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="#xsky host启动的时候需要使用iptables -F清防火墙规则, 或者开放以下端口   8056    8051    8052    5432    5433    2380    2379     9200    9300     6789    6800-7300  #添加xsky主存储   AddXSkyPrimaryStorage name=xsky zoneUuid=6543">
<meta name="keywords">
<meta property="og:type" content="article">
<meta property="og:title" content="Glody's Notes">
<meta property="og:url" content="http://glody.net/2017/11/10/Markdown/xsky/index.html">
<meta property="og:site_name" content="Glody's Notes">
<meta property="og:description" content="#xsky host启动的时候需要使用iptables -F清防火墙规则, 或者开放以下端口   8056    8051    8052    5432    5433    2380    2379     9200    9300     6789    6800-7300  #添加xsky主存储   AddXSkyPrimaryStorage name=xsky zoneUuid=6543">
<meta property="og:updated_time" content="2017-11-10T07:43:06.798Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Glody's Notes">
<meta name="twitter:description" content="#xsky host启动的时候需要使用iptables -F清防火墙规则, 或者开放以下端口   8056    8051    8052    5432    5433    2380    2379     9200    9300     6789    6800-7300  #添加xsky主存储   AddXSkyPrimaryStorage name=xsky zoneUuid=6543">
  
  
    <link rel="icon" href="https://avatars3.githubusercontent.com/u/1768868?v=3&s=460">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlight.css">
  <link href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  
</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
</div>
<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar" style="background-image:url(https://avatars3.githubusercontent.com/u/1768868?v=3&amp;s=460)"></a>
<div class="author">
    <span>Glody Guo</span>
</div>
<div class="icon">
    
    <a class="github" title="github" href="https://github.com/glody" target="_blank"></a>
    
    
    
    
    <a class="linkedin" title="linkedin" href="https://www.linkedin.com/in/glody" target="_blank"></a>
    
    
    
    <a class="mail" title="mail" href="mailto:glody.guo@gmail.com"></a>
    
</div>
<ul>
    <li class="all active">全部文章</li>
    
</ul>
    </div>
    <div class="nav-right">
        <form onkeydown="if(event.keyCode==13){return false;}">
    <input class="search" type="text" placeholder="Search..." autocomplete="off">
    <span>
        <label for="tagswitch">Tags:</label>
        <input id="tagswitch" type="checkbox">
    </span>
</form>
<ul class="tags-list">
    
    <div class="clearfix"></div>
</ul>

<nav>
    
    <a class="" href="/2017/11/10/Markdown/AddSecurityGroupRule/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:43:03">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/ad/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:42:55">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/cannot_sariablize_None/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:43:04">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/eth0/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:43:01">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/gist/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:42:51">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/hwinfo/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:42:56">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/iostat/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:42:59">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/iotop/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:42:58">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/ldap/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:42:54">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/network/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:43:04">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/password/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:43:07">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/remount/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:42:54">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/restful_api/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:43:08">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/s3cmd/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:43:08">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/sar/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:42:57">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/shell/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:43:09">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/shadowsocks/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:42:53">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/sysstat/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:42:57">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/top/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:42:59">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/tui_setup/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:43:02">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/unzip/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:42:52">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/uptime/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:43:00">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/vim/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:43:10">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/virsh/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:42:53">2017/11/10</span>
    </a>
    
    <a class="" href="/2017/11/10/Markdown/xsky/" data-tag="">
        <span class="post-title" title=""></span>
        <span class="post-date" title="2017-11-10 15:43:06">2017/11/10</span>
    </a>
    
</nav>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-Markdown/xsky" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
      
      <time class="date" title="2017-11-10 15:43:06">2017 November 10</time>
      
      
  </div>
    
    <div class="toc-ref">
        
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>#xsky host启动的时候需要使用iptables -F清防火墙规则, 或者开放以下端口  </p>
<pre><code class="lang:shell">8056   
8051   
8052   
5432   
5433   
2380   
2379    
9200   
9300    
6789   
6800-7300
</code></pre>
<p>#添加xsky主存储  </p>
<pre><code class="lang:shell">AddXSkyPrimaryStorage name=xsky zoneUuid=65435a3ca1264296bb795f77e50d0187 monUrls=root:password@172.20.197.238/?monPort=6789
</code></pre>
<p>#获取accessToken（这里的ak是xsky里面的ak），在xsky的host上执行  </p>
<pre><code class="lang:shell">xms-cli --user admin -p password access-token create --roles admin dev
</code></pre>
<p>#创建存储平台</p>
<pre><code class="lang:shell">CreateOSSProtectionSite accessToken=cdcbbbce3bc14ec780d439fd266227a5 accessUrl=oss-cn-shanghai.aliyuncs.com name=xsky hybridAccountUuid=39c510d3183f4e7aa2bb2dd75e0ed838 bucketName=gbkt1 primaryStorageUuid=3b544784ff9a4e84b7b065fa9db4aafb
</code></pre>
<p>#查询存储平台  </p>
<pre><code class="lang:shell">GetProtectionSites accessToken=cdcbbbce3bc14ec780d439fd266227a5 primaryStorageUuid=3b544784ff9a4e84b7b065fa9db4aafb
</code></pre>
<p>#查询保护服务器（xsky里面的服务器）  </p>
<pre><code class="lang:shell">GetProtectionHosts accessToken=cdcbbbce3bc14ec780d439fd266227a5 primaryStorageUuid=eaec803bc78843c58f37b08c3da89648
</code></pre>
<p>#创建保护网关  </p>
<pre><code class="lang:shell">CreateProtectionGateway accessToken=cdcbbbce3bc14ec780d439fd266227a5 primaryStorageUuid=eaec803bc78843c58f37b08c3da89648 name=xsky_gw protectionHostId=1
</code></pre>
<p>#查询保护网关  </p>
<pre><code class="lang:shell">GetProtectionGateways accessToken=cdcbbbce3bc14ec780d439fd266227a5 primaryStorageUuid=eaec803bc78843c58f37b08c3da89648
</code></pre>
<p>#创建保护策略  </p>
<pre><code class="lang:shell">#CreateProtectionPolicy name=xskypolicy accessToken=cdcbbbce3bc14ec780d439fd266227a5 primaryStorageUuid=eaec803bc78843c58f37b08c3da89648 fullBackupIntervalTimes=300  backupRetainedDays=1 siteId=1 gatewayId=2  
CreateProtectionPolicy name=xskypolicy accessToken=cdcbbbce3bc14ec780d439fd266227a5 primaryStorageUuid=47c66bbaa72d46bd94123ac6f8200243 fullBackupIntervalTimes=300 backupRetainedDays=1 siteId=8 gatewayId=3 backupIntervalInHour=1
</code></pre>
<p>#查询保护策略  </p>
<pre><code class="lang:shell">GetProtectionPolicies accessToken=cdcbbbce3bc14ec780d439fd266227a5 primaryStorageUuid=eaec803bc78843c58f37b08c3da89648
</code></pre>
<p>#获取volume</p>
<pre><code class="lang:shell">GetProtectionVolumes accessToken=cdcbbbce3bc14ec780d439fd266227a5 primaryStorageUuid=47c66bbaa72d46bd94123ac6f8200243
</code></pre>
<p>#创建保护组</p>
<pre><code class="lang:shell">CreateProtectionGroup accessToken=cdcbbbce3bc14ec780d439fd266227a5 primaryStorageUuid=47c66bbaa72d46bd94123ac6f8200243 name=xsky-group volumeIds=3 policyId=2
</code></pre>
<p>#为每个host添加vlan网卡  </p>
<pre><code class="lang:shell">vconfig add eth0 1010  
vconfig add eth0 1011
</code></pre>
<p>#查看pool内容</p>
<pre><code class="lang:shell">rados ls -p pool-60ca87e02cff4185b21f2b70feba337c
rados rm rbd_data.790df6b8b4567.0000000000000806 -p pool-60ca87e02cff4185b21f2b70feba337c #删除一个object
</code></pre>
<p>#清空pool</p>
<pre><code class="lang:shell">rados purge pool-60ca87e02cff4185b21f2b70feba337c --yes-i-really-really-mean-it
</code></pre>

      
    </div>
</article>


    

    </div>
</div>
<div class="full-toc">
    <button class="full"><span class="min"></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
</div>
</body>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery.pjax/1.9.6/jquery.pjax.min.js"></script>
<script src="/js/script.js"></script>
</html>
